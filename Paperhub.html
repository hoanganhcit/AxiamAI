<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>White Paper Hub – HTML + Bootstrap + jQuery</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    :root {
      --soft-border: #e5e7eb;
    }

    body {
      background: linear-gradient(180deg, #ffffff, #f8fafc);
    }

    .brand-square {
      width: 36px;
      height: 36px;
      border-radius: 16px;
      background: #0f172a;
      color: #fff;
      font-weight: 700;
      display: grid;
      place-items: center;
    }

    .card-hover:hover {
      box-shadow: 0 .25rem .75rem rgba(0, 0, 0, .05);
    }

    .tag-badge {
      cursor: pointer;
    }

    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .sticky-top-blur {
      backdrop-filter: saturate(180%) blur(10px);
      background: rgba(255, 255, 255, .8);
      border-bottom: 1px solid #e5e7eb;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid transparent;
    }

    .btn-ghost:hover {
      background: #f1f5f9;
    }

    .stat {
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 1rem;
    }

    .cursor-default {
      cursor: default;
    }
  </style>
</head>

<body>
  <!-- Top Bar -->
  <header class="sticky-top sticky-top-blur py-3">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-2">
        <div class="brand-square">WP</div>
        <div>
          <h1 class="h5 mb-0">White Paper Hub</h1>
          <small class="text-secondary">Publish research papers & articles</small>
        </div>
      </div>
      <div class="d-flex gap-2">
        <button id="btn-new" class="btn btn-primary d-flex align-items-center gap-2" data-bs-toggle="modal"
          data-bs-target="#newPostModal">
          <i class="bi bi-plus-lg"></i> Publish
        </button>
        <button id="btn-bulk" class="btn btn-outline-secondary d-flex align-items-center gap-2">
          <i class="bi bi-upload"></i> Bulk import
        </button>
        <input id="bulkFile" type="file" accept="application/json" class="d-none" />
      </div>
    </div>
  </header>

  <main class="container py-4">
    <div class="row g-4">
      <div class="col-12 col-lg-8">
        <!-- Search + Sort -->
        <div class="card border-0" style="border:1px solid #e5e7eb">
          <div class="card-body">
            <div
              class="d-flex flex-column flex-md-row gap-3 align-items-stretch align-items-md-center justify-content-between">
              <div class="flex-grow-1">
                <div class="input-group">
                  <span class="input-group-text bg-transparent"><i class="bi bi-search text-secondary"></i></span>
                  <input id="searchInput" type="text" class="form-control" placeholder="Search by title, author, tag…"
                    aria-label="Search" />
                </div>
              </div>
              <div class="d-flex gap-2 align-items-center">
                <div class="dropdown">
                  <button class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center gap-2"
                    type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-funnel"></i> Sort
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end" id="sortMenu">
                    <li>
                      <h6 class="dropdown-header">Sort by</h6>
                    </li>
                    <li><a class="dropdown-item sort-option" data-sort="newest" href="#">Newest</a></li>
                    <li><a class="dropdown-item sort-option" data-sort="oldest" href="#">Oldest</a></li>
                    <li><a class="dropdown-item sort-option" data-sort="az" href="#">Title A–Z</a></li>
                  </ul>
                </div>
                <button id="clearTagBtn" class="btn btn-ghost d-none align-items-center gap-2">
                  <i class="bi bi-tag"></i>
                  <span id="activeTagText" class="small"></span>
                  <span class="text-secondary small">(clear)</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Pinned -->
        <div id="pinnedWrapper" class="mt-3 d-none">
          <div class="card border-0" style="border:1px solid #e5e7eb">
            <div class="card-header bg-white border-0 pt-3">
              <div class="text-warning text-uppercase fw-semibold small d-flex align-items-center gap-2">
                <i class="bi bi-file-earmark-text"></i> Pinned white paper
              </div>
            </div>
            <div class="card-body pt-0">
              <h3 id="pinnedTitle" class="h4 mb-2"></h3>
              <p id="pinnedSummary" class="text-secondary"></p>
              <div class="d-flex flex-wrap align-items-center gap-3 small text-muted mb-2" id="pinnedMeta"></div>
              <div class="d-flex flex-wrap gap-2 mb-3" id="pinnedTags"></div>
              <div class="d-flex gap-2" id="pinnedActions"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats -->
      <aside class="col-12 col-lg-4">
        <div class="card border-0" style="border:1px solid #e5e7eb">
          <div class="card-body">
            <h6 class="mb-1">Library snapshot</h6>
            <small class="text-secondary">Current publication mix</small>
            <div class="row text-center g-3 mt-2">
              <div class="col-4">
                <div class="p-3 stat">
                  <div class="h4 mb-0" id="stat-total">0</div>
                  <div class="small text-secondary">Total</div>
                </div>
              </div>
              <div class="col-4">
                <div class="p-3 stat">
                  <div class="h4 mb-0" id="stat-whitepapers">0</div>
                  <div class="small text-secondary">White papers</div>
                </div>
              </div>
              <div class="col-4">
                <div class="p-3 stat">
                  <div class="h4 mb-0" id="stat-articles">0</div>
                  <div class="small text-secondary">Articles</div>
                </div>
              </div>
            </div>
            <div class="mt-2 small text-secondary">Tip: click a tag to filter; use the + button to publish.</div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Tabs -->
    <section class="pt-4">
      <ul class="nav nav-tabs" id="typeTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="tab-all" data-bs-toggle="tab" data-bs-target="#pane-all" type="button"
            role="tab" aria-controls="pane-all" aria-selected="true">All</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab-whitepaper" data-bs-toggle="tab" data-bs-target="#pane-whitepaper"
            type="button" role="tab" aria-controls="pane-whitepaper" aria-selected="false"><i
              class="bi bi-file-earmark-text me-1"></i> White papers</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab-article" data-bs-toggle="tab" data-bs-target="#pane-article" type="button"
            role="tab" aria-controls="pane-article" aria-selected="false"><i class="bi bi-book me-1"></i>
            Articles</button>
        </li>
      </ul>
      <div class="tab-content pt-3">
        <div class="tab-pane fade show active" id="pane-all" role="tabpanel" aria-labelledby="tab-all">
          <div id="grid-all" class="row g-4"></div>
          <div id="empty-all" class="d-none">
            <div class="card border-0" style="border:1px solid #e5e7eb">
              <div class="card-body text-center py-5">
                <i class="bi bi-search display-6 text-secondary"></i>
                <h5 class="mt-2 mb-1">No results found</h5>
                <p class="text-secondary mb-3">Try adjusting your search or clearing filters.</p>
                <button id="btn-clear-filters" class="btn btn-outline-secondary">Clear filters</button>
              </div>
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="pane-whitepaper" role="tabpanel" aria-labelledby="tab-whitepaper">
          <div id="grid-whitepaper" class="row g-4"></div>
          <div id="empty-whitepaper" class="d-none text-center text-secondary">No white papers.</div>
        </div>
        <div class="tab-pane fade" id="pane-article" role="tabpanel" aria-labelledby="tab-article">
          <div id="grid-article" class="row g-4"></div>
          <div id="empty-article" class="d-none text-center text-secondary">No articles.</div>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-top py-4 mt-4">
    <div
      class="container d-flex flex-column flex-md-row align-items-center justify-content-between gap-2 text-secondary small">
      <div>© <span id="copyrightYear"></span> White Paper Hub. All rights reserved.</div>
      <div>Built with <span class="fw-semibold">HTML + Bootstrap</span>. Swap the data with your CMS.</div>
    </div>
  </footer>

  <!-- Details Modal -->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detailsTitle"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex flex-wrap gap-4 align-items-center small text-muted mb-3" id="detailsMeta"></div>
          <p id="detailsSummary" class="mb-3"></p>
          <div class="d-flex flex-wrap gap-2" id="detailsTags"></div>
        </div>
        <div class="modal-footer" id="detailsActions"></div>
      </div>
    </div>
  </div>

  <!-- New Post Modal -->
  <div class="modal fade" id="newPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Publish new entry</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="newPostForm" class="row g-3">
            <div class="col-12">
              <label class="form-label" for="np-title">Title</label>
              <input id="np-title" class="form-control" placeholder="e.g., Zero Trust with Verified Identity"
                required />
            </div>
            <div class="col-md-6">
              <label class="form-label" for="np-type">Type</label>
              <select id="np-type" class="form-select">
                <option value="whitepaper">White paper</option>
                <option value="article">Article</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="np-date">Date</label>
              <input id="np-date" type="date" class="form-control" />
            </div>
            <div class="col-12">
              <label class="form-label" for="np-authors">Authors</label>
              <input id="np-authors" class="form-control" placeholder="Comma‑separated, e.g., Jane Doe, John Roe" />
            </div>
            <div class="col-12">
              <label class="form-label" for="np-tags">Tags</label>
              <input id="np-tags" class="form-control"
                placeholder="Comma‑separated, e.g., identity, zero trust, privacy" />
            </div>
            <div class="col-12">
              <label class="form-label" for="np-summary">Abstract / Summary</label>
              <textarea id="np-summary" rows="5" class="form-control"
                placeholder="Write a concise abstract…"></textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="np-read">Read URL</label>
              <input id="np-read" class="form-control" placeholder="https://… (optional)" />
            </div>
            <div class="col-md-6">
              <label class="form-label" for="np-download">Download URL</label>
              <input id="np-download" class="form-control" placeholder="https://… (optional)" />
            </div>
            <div class="col-12 form-check mt-2">
              <input class="form-check-input" type="checkbox" id="np-pinned" />
              <label class="form-check-label" for="np-pinned">Pin this white paper</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button id="np-submit" type="button" class="btn btn-primary d-flex align-items-center gap-2">
            <i class="bi bi-upload"></i> Publish
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery + Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>

  <script>
    // ------------------ Data ------------------
    const initialPosts = [
      {
        id: "wp-001",
        title: "Verified Identity at the Edge: A White Paper on Passwordless Access",
        type: "whitepaper",
        authors: ["Henry Quach", "A. Sharma"],
        date: "2025-07-12",
        tags: ["identity", "passwordless", "zero trust"],
        summary:
          "A deep dive into replacing usernames, passwords, and weak MFA with verified identity at the front door. Covers threat models, architecture, and measurable risk reduction.",
        readUrl: "#",
        downloadUrl: "#",
        pinned: true,
      },
      {
        id: "ar-002",
        title: "Trends in MFA Bypass Tactics, 2023–2025",
        type: "article",
        authors: ["J. Patel"],
        date: "2025-05-28",
        tags: ["MFA", "attack techniques", "phishing"],
        summary:
          "Survey of real‑world incidents showing the evolution from phishing kits to adversary‑in‑the‑middle and prompt bombing, with mitigations that actually work.",
        readUrl: "#",
      },
      {
        id: "wp-003",
        title: "Designing a Bastion Gateway for Human‑Verified Access",
        type: "whitepaper",
        authors: ["C. Nguyen"],
        date: "2025-04-04",
        tags: ["bastion host", "infrastructure", "governance"],
        summary:
          "Reference architecture for a single secure gateway that enforces identity assurance before any network touch, including audit, HA, and rollout playbooks.",
        downloadUrl: "#",
      },
      {
        id: "ar-004",
        title: "Measuring the Real Cost of Account Takeover",
        type: "article",
        authors: ["S. Li", "R. Thompson"],
        date: "2025-03-17",
        tags: ["economics", "risk", "incident response"],
        summary:
          "A practical model to quantify downtime, recovery labor, legal exposure, and customer churn when credentials are compromised.",
        readUrl: "#",
      },
      {
        id: "wp-005",
        title: "Privacy by Design in Face-Based Sign‑In Systems",
        type: "whitepaper",
        authors: ["M. Chen"],
        date: "2025-01-09",
        tags: ["privacy", "biometrics", "compliance"],
        summary:
          "Guidance for encrypted templates, liveness, and regional compliance (PIPEDA, GDPR, CCPA) with deployment checklists.",
        readUrl: "#",
        downloadUrl: "#",
      },
    ];

    // ------------------ State ------------------
    let posts = loadPosts();
    let query = "";
    let activeTab = "all"; // all | whitepaper | article
    let sortMode = "newest"; // newest | oldest | az
    let tagFilter = "";

    // ------------------ Helpers ------------------
    function loadPosts() {
      try { const saved = localStorage.getItem('wphub.posts'); if (saved) return JSON.parse(saved); } catch (e) { }
      return initialPosts;
    }
    function savePosts() { try { localStorage.setItem('wphub.posts', JSON.stringify(posts)); } catch (e) { } }

    function formatDate(iso) {
      const d = new Date(iso);
      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: '2-digit' });
    }

    function getFiltered() {
      let list = posts.slice();
      if (activeTab !== "all") list = list.filter(p => p.type === activeTab);
      if (query.trim()) {
        const q = query.toLowerCase();
        list = list.filter(p =>
          p.title.toLowerCase().includes(q) ||
          p.summary.toLowerCase().includes(q) ||
          p.authors.join(" ").toLowerCase().includes(q) ||
          p.tags.join(" ").toLowerCase().includes(q)
        );
      }
      if (tagFilter) { list = list.filter(p => p.tags.includes(tagFilter)); }
      if (sortMode === 'newest') list.sort((a, b) => new Date(b.date) - new Date(a.date));
      else if (sortMode === 'oldest') list.sort((a, b) => new Date(a.date) - new Date(b.date));
      else if (sortMode === 'az') list.sort((a, b) => a.title.localeCompare(b.title));
      return list;
    }

    function statCount(type) { return posts.filter(p => p.type === type).length; }

    // ------------------ Rendering ------------------
    function render() {
      // Stats
      $('#stat-total').text(posts.length);
      $('#stat-whitepapers').text(statCount('whitepaper'));
      $('#stat-articles').text(statCount('article'));

      // Pinned
      const pinned = posts.find(p => p.pinned);
      if (pinned) {
        $('#pinnedWrapper').removeClass('d-none');
        $('#pinnedTitle').text(pinned.title);
        $('#pinnedSummary').text(pinned.summary || '');
        $('#pinnedMeta').html(`
          <span class="d-inline-flex align-items-center gap-1"><i class="bi bi-person"></i> ${pinned.authors.join(', ')}</span>
          <span class="d-inline-flex align-items-center gap-1"><i class="bi bi-calendar"></i> ${formatDate(pinned.date)}</span>
        `);
        const tagsHtml = pinned.tags.map(t => `<span class="badge text-bg-light border tag-badge" data-tag="${t}"><i class="bi bi-tag me-1"></i>${t}</span>`).join(' ');
        $('#pinnedTags').html(tagsHtml);
        let actions = '';
        if (pinned.readUrl) actions += `<a href="${pinned.readUrl}" target="_blank" class="btn btn-primary d-inline-flex align-items-center gap-2"><i class="bi bi-eye"></i> Read online</a>`;
        if (pinned.downloadUrl) actions += `<a href="${pinned.downloadUrl}" class="btn btn-outline-secondary d-inline-flex align-items-center gap-2"><i class="bi bi-download"></i> Download PDF</a>`;
        $('#pinnedActions').html(actions);
      } else {
        $('#pinnedWrapper').addClass('d-none');
      }

      // Clear tag button state
      if (tagFilter) {
        $('#activeTagText').text(tagFilter);
        $('#clearTagBtn').removeClass('d-none');
      } else {
        $('#clearTagBtn').addClass('d-none');
      }

      // Grids
      const filtered = getFiltered();
      const buckets = {
        all: filtered,
        whitepaper: filtered.filter(p => p.type === 'whitepaper'),
        article: filtered.filter(p => p.type === 'article'),
      };

      for (const key of ['all', 'whitepaper', 'article']) {
        const grid = $(`#grid-${key}`);
        grid.empty();
        buckets[key].forEach(p => grid.append(renderCard(p)));
        const empty = $(`#empty-${key}`);
        if (buckets[key].length === 0) { empty.removeClass('d-none'); } else { empty.addClass('d-none'); }
      }

      // wire tag clicks (delegated too but ensure pinned area works)
      $('[data-tag]').off('click').on('click', function () {
        tagFilter = $(this).data('tag'); render();
      });
    }

    function renderCard(p) {
      const tagBadges = p.tags.map(t => `<span class="badge text-bg-light border tag-badge" data-tag="${t}"><i class="bi bi-tag me-1"></i>${t}</span>`).join(' ');
      const readBtn = p.readUrl ? `<a href="${p.readUrl}" target="_blank" class="btn btn-primary"><i class="bi bi-eye me-1"></i> Details</a>` : `<button class="btn btn-primary btn-details" data-id="${p.id}"><i class="bi bi-eye me-1"></i> Details</button>`;
      return `
        <div class="col-12 col-md-6 col-xl-4">
          <div class="card card-hover h-100 border-0" style="border:1px solid #e5e7eb">
            <div class="card-body d-flex flex-column">
              <div class="d-flex align-items-center justify-content-between small text-secondary mb-2">
                <span class="badge ${p.type === 'whitepaper' ? 'text-bg-primary' : 'text-bg-secondary'}">${p.type === 'whitepaper' ? 'White paper' : 'Article'}</span>
                <span><i class="bi bi-calendar me-1"></i>${formatDate(p.date)}</span>
              </div>
              <h6 class="mb-1">${p.title}</h6>
              <div class="small text-muted mb-2"><i class="bi bi-person me-1"></i>${p.authors.join(', ')}</div>
              <p class="text-secondary small mb-3 line-clamp-3">${p.summary || ''}</p>
              <div class="d-flex flex-wrap gap-2 mb-3">${tagBadges}</div>
              <div class="mt-auto d-flex gap-2">
                <button class="btn btn-outline-secondary btn-details" data-id="${p.id}"><i class="bi bi-eye me-1"></i> Details</button>
                ${p.downloadUrl ? `<a class="btn btn-outline-secondary" href="${p.downloadUrl}"><i class=\"bi bi-download me-1\"></i> Download</a>` : ''}
              </div>
            </div>
          </div>
        </div>`;
    }

    // ------------------ Details Modal Control ------------------
    function openDetails(id) {
      const p = posts.find(x => x.id === id);
      if (!p) return;
      $('#detailsTitle').text(p.title);
      $('#detailsSummary').text(p.summary || '');
      $('#detailsMeta').html(`
        <span class="d-inline-flex align-items-center gap-1"><i class="bi bi-person"></i> ${p.authors.join(', ')}</span>
        <span class="d-inline-flex align-items-center gap-1"><i class="bi bi-calendar"></i> ${formatDate(p.date)}</span>
      `);
      $('#detailsTags').html(p.tags.map(t => `<span class="badge text-bg-light border">${t}</span>`).join(' '));
      let actions = '';
      if (p.readUrl) actions += `<a href="${p.readUrl}" target="_blank" class="btn btn-primary d-inline-flex align-items-center gap-2"><i class="bi bi-box-arrow-up-right"></i> Read online</a>`;
      if (p.downloadUrl) actions += `<a href="${p.downloadUrl}" class="btn btn-outline-secondary d-inline-flex align-items-center gap-2"><i class="bi bi-download"></i> Download PDF</a>`;
      $('#detailsActions').html(actions || '<span class="text-secondary small">No external links.</span>');
      const modal = new bootstrap.Modal(document.getElementById('detailsModal'));
      modal.show();
    }

    // ------------------ Events ------------------
    $(document).on('input', '#searchInput', function () { query = $(this).val(); render(); });
    $(document).on('click', '.sort-option', function (e) { e.preventDefault(); sortMode = $(this).data('sort'); render(); });
    $(document).on('shown.bs.tab', '#typeTabs button[data-bs-toggle="tab"]', function (e) {
      const target = $(e.target).attr('data-bs-target');
      activeTab = target.replace('#pane-', '');
      render();
    });
    $(document).on('click', '#btn-clear-filters', function () { query = ''; tagFilter = ''; $('#searchInput').val(''); render(); });
    $(document).on('click', '#clearTagBtn', function () { tagFilter = ''; render(); });
    $(document).on('click', '.btn-details', function () { const id = $(this).data('id'); openDetails(id); });

    // Tag clicks are delegated via data-tag in render()

    // Bulk import JSON
    $('#btn-bulk').on('click', () => $('#bulkFile').trigger('click'));
    $('#bulkFile').on('change', function () {
      const file = this.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const arr = JSON.parse(reader.result);
          if (Array.isArray(arr)) {
            // naive validation
            arr.forEach(item => { if (!item.id) item.id = `${item.type || 'wp'}-${Date.now()}-${Math.random().toString(36).slice(2, 6)}` });
            posts = arr.concat(posts);
            savePosts();
            render();
          } else { alert('JSON must be an array of posts.'); }
        } catch (err) { alert('Invalid JSON file.'); }
      };
      reader.readAsText(file);
      $(this).val('');
    });

    // New Post
    function resetNewPost() {
      $('#newPostForm')[0].reset();
      $('#np-date').val(new Date().toISOString().slice(0, 10));
    }
    $('#newPostModal').on('shown.bs.modal', resetNewPost);
    $('#np-submit').on('click', function () {
      const title = $('#np-title').val().toString().trim();
      if (!title) { $('#np-title')[0].reportValidity(); return; }
      const type = $('#np-type').val();
      const date = $('#np-date').val() || new Date().toISOString().slice(0, 10);
      const authors = $('#np-authors').val().toString().split(',').map(s => s.trim()).filter(Boolean);
      const tags = $('#np-tags').val().toString().split(',').map(s => s.trim()).filter(Boolean);
      const summary = $('#np-summary').val().toString().trim();
      const readUrl = $('#np-read').val().toString().trim();
      const downloadUrl = $('#np-download').val().toString().trim();
      const pinned = $('#np-pinned').is(':checked');

      if (pinned) { posts.forEach(p => delete p.pinned); }

      const post = { id: `${type}-${Date.now()}`, title, type, authors, date, tags, summary };
      if (readUrl) post.readUrl = readUrl; if (downloadUrl) post.downloadUrl = downloadUrl; if (pinned) post.pinned = true;
      posts = [post, ...posts];
      savePosts();
      render();
      const modalEl = document.getElementById('newPostModal');
      bootstrap.Modal.getInstance(modalEl).hide();
    });

    // Footer year
    $('#copyrightYear').text(new Date().getFullYear());

    // Initial date value
    $('#np-date').val(new Date().toISOString().slice(0, 10));

    // First render
    render();
  </script>
</body>

</html>